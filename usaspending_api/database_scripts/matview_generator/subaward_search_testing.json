{
  "schema_name": "rpt",
  "final_name": "subaward_search_testing",
  "refresh": true,
  "matview_sql": [
    "SELECT",
    "    NOW() AS created_at,",
    "    NOW() AS updated_at,",
    "",
    "    -- Broker Subaward Table Meta",
    "    bs.created_at AS broker_created_at,",
    "    bs.updated_at AS broker_updated_at,",
    "    bs.id::BIGINT AS broker_subaward_id,",
    "",
    "    -- Prime Award Fields (from Broker)",
    "    bs.unique_award_key,",
    "    bs.award_id AS award_piid_fain,",
    "    bs.parent_award_id,",
    "    bs.award_amount::NUMERIC(23,2),",
    "    bs.action_date::DATE,",
    "    bs.fy,",
    "    bs.awarding_agency_code,",
    "    bs.awarding_agency_name,",
    "    bs.awarding_sub_tier_agency_c,",
    "    bs.awarding_sub_tier_agency_n,",
    "    bs.awarding_office_code,",
    "    bs.awarding_office_name,",
    "    bs.funding_agency_code,",
    "    bs.funding_agency_name,",
    "    bs.funding_sub_tier_agency_co,",
    "    bs.funding_sub_tier_agency_na,",
    "    bs.funding_office_code,",
    "    bs.funding_office_name,",
    "    bs.awardee_or_recipient_uniqu,",
    "    bs.awardee_or_recipient_uei,",
    "    UPPER(bs.awardee_or_recipient_legal) AS awardee_or_recipient_legal,",
    "    bs.dba_name,",
    "    bs.ultimate_parent_unique_ide,",
    "    bs.ultimate_parent_uei,",
    "    bs.ultimate_parent_legal_enti,",
    "    bs.legal_entity_country_code,",
    "    bs.legal_entity_country_name,",
    "    bs.legal_entity_state_code,",
    "    bs.legal_entity_state_name,",
    "    bs.legal_entity_zip,",
    "    bs.legal_entity_congressional,",
    "    bs.legal_entity_foreign_posta,",
    "    bs.legal_entity_city_name,",
    "    bs.legal_entity_address_line1,",
    "    bs.business_types,",
    "    bs.place_of_perform_country_co,",
    "    bs.place_of_perform_country_na,",
    "    bs.place_of_perform_state_code,",
    "    bs.place_of_perform_state_name,",
    "    bs.place_of_performance_zip,",
    "    bs.place_of_perform_congressio,",
    "    bs.place_of_perform_city_name,",
    "    bs.place_of_perform_street,",
    "    bs.award_description,",
    "    bs.naics,",
    "    bs.naics_description,",
    "    bs.cfda_numbers,",
    "    bs.cfda_titles,",
    "",
    "    -- Subaward Fields (from Broker)",
    "    bs.subaward_type,",
    "    bs.subaward_report_year::SMALLINT,",
    "    bs.subaward_report_month::SMALLINT,",
    "    UPPER(bs.subaward_number) AS subaward_number,",
    "    bv.amount AS subaward_amount,",
    "    bs.sub_action_date::DATE,",
    "    UPPER(bs.sub_awardee_or_recipient_uniqu) AS sub_awardee_or_recipient_uniqu,",
    "    UPPER(bs.sub_awardee_or_recipient_uei) AS sub_awardee_or_recipient_uei,",
    "    UPPER(bs.sub_awardee_or_recipient_legal) AS sub_awardee_or_recipient_legal_raw,",
    "    UPPER(bs.sub_dba_name) AS sub_dba_name,",
    "    UPPER(bs.sub_ultimate_parent_unique_ide) AS sub_ultimate_parent_unique_ide,",
    "    UPPER(bs.sub_ultimate_parent_uei) AS sub_ultimate_parent_uei,",
    "    UPPER(bs.sub_ultimate_parent_legal_enti) AS sub_ultimate_parent_legal_enti_raw,",
    "    UPPER(bs.sub_legal_entity_country_code) AS sub_legal_entity_country_code_raw,",
    "    bs.sub_legal_entity_country_name AS sub_legal_entity_country_name_raw,",
    "    UPPER(bs.sub_legal_entity_state_code) AS sub_legal_entity_state_code,",
    "    UPPER(bs.sub_legal_entity_state_name) AS sub_legal_entity_state_name,",
    "    bs.sub_legal_entity_zip,",
    "    UPPER(bs.sub_legal_entity_congressional) AS sub_legal_entity_congressional_raw,",
    "    bs.sub_legal_entity_foreign_posta,",
    "    UPPER(bs.sub_legal_entity_city_name) AS sub_legal_entity_city_name,",
    "    UPPER(bs.sub_legal_entity_address_line1) AS sub_legal_entity_address_line1,",
    "    UPPER(bs.sub_business_types) AS sub_business_types,",
    "    UPPER(bs.sub_place_of_perform_country_co) AS sub_place_of_perform_country_co_raw,",
    "    bs.sub_place_of_perform_country_na,",
    "    UPPER(bs.sub_place_of_perform_state_code) AS sub_place_of_perform_state_code,",
    "    UPPER(bs.sub_place_of_perform_state_name) AS sub_place_of_perform_state_name,",
    "    bs.sub_place_of_performance_zip,",
    "    UPPER(bs.sub_place_of_perform_congressio) AS sub_place_of_perform_congressio_raw,",
    "    UPPER(bs.sub_place_of_perform_city_name) AS sub_place_of_perform_city_name,",
    "    UPPER(bs.sub_place_of_perform_street) AS sub_place_of_perform_street,",
    "    UPPER(bs.subaward_description) AS subaward_description,",
    "    bs.sub_high_comp_officer1_full_na,",
    "    bs.sub_high_comp_officer1_amount::NUMERIC(23,2),",
    "    bs.sub_high_comp_officer2_full_na,",
    "    bs.sub_high_comp_officer2_amount::NUMERIC(23,2),",
    "    bs.sub_high_comp_officer3_full_na,",
    "    bs.sub_high_comp_officer3_amount::NUMERIC(23,2),",
    "    bs.sub_high_comp_officer4_full_na,",
    "    bs.sub_high_comp_officer4_amount::NUMERIC(23,2),",
    "    bs.sub_high_comp_officer5_full_na,",
    "    bs.sub_high_comp_officer5_amount::NUMERIC(23,2),",
    "",
    "    -- Additional Prime Award Fields (from Broker)",
    "    bs.prime_id,",
    "    UPPER(bs.internal_id) AS internal_id,",
    "    bs.date_submitted::TIMESTAMP,",
    "    bs.report_type,",
    "    bs.transaction_type,",
    "    bs.program_title,",
    "    bs.contract_agency_code,",
    "    bs.contract_idv_agency_code,",
    "    bs.grant_funding_agency_id,",
    "    bs.grant_funding_agency_name,",
    "    bs.federal_agency_name,",
    "    bs.treasury_symbol,",
    "    bs.dunsplus4,",
    "    bs.recovery_model_q1::BOOLEAN,",
    "    bs.recovery_model_q2::BOOLEAN,",
    "    bs.compensation_q1::BOOLEAN,",
    "    bs.compensation_q2::BOOLEAN,",
    "    bs.high_comp_officer1_full_na,",
    "    bs.high_comp_officer1_amount::NUMERIC(23,2),",
    "    bs.high_comp_officer2_full_na,",
    "    bs.high_comp_officer2_amount::NUMERIC(23,2),",
    "    bs.high_comp_officer3_full_na,",
    "    bs.high_comp_officer3_amount::NUMERIC(23,2),",
    "    bs.high_comp_officer4_full_na,",
    "    bs.high_comp_officer4_amount::NUMERIC(23,2),",
    "    bs.high_comp_officer5_full_na,",
    "    bs.high_comp_officer5_amount::NUMERIC(23,2),",
    "",
    "    -- Additional Subaward Fields (from Broker)",
    "    bs.sub_id,",
    "    bs.sub_parent_id,",
    "    bs.sub_federal_agency_id,",
    "    bs.sub_federal_agency_name,",
    "    bs.sub_funding_agency_id,",
    "    bs.sub_funding_agency_name,",
    "    bs.sub_funding_office_id,",
    "    bs.sub_funding_office_name,",
    "    bs.sub_naics,",
    "    bs.sub_cfda_numbers,",
    "    bs.sub_dunsplus4,",
    "    bs.sub_recovery_subcontract_amt,",
    "    bs.sub_recovery_model_q1::BOOLEAN,",
    "    bs.sub_recovery_model_q2::BOOLEAN,",
    "    bs.sub_compensation_q1::BOOLEAN,",
    "    bs.sub_compensation_q2::BOOLEAN,",
    "",
    "    -- USAS Links (and associated derivations)",
    "    st.award_id,",
    "    st.award_type AS prime_award_group,",
    "    st.prime_award_type,",
    "    st.piid,",
    "    st.fain,",
    "    st.latest_transaction_id,",
    "    st.last_modified_date,",
    "",
    "    st.awarding_agency_id,",
    "    st.awarding_toptier_agency_name,",
    "    st.awarding_toptier_agency_abbreviation,",
    "    st.awarding_subtier_agency_name,",
    "    st.awarding_subtier_agency_abbreviation,",
    "    st.funding_agency_id,",
    "    st.funding_subtier_agency_abbreviation,",
    "    st.funding_subtier_agency_name,",
    "    st.funding_toptier_agency_abbreviation,",
    "    st.funding_toptier_agency_name,",
    "",
    "    st.cfda_id,",
    "    st.cfda_number,",
    "    st.cfda_title,",
    "",
    "    -- USAS Derived Fields",
    "    sv.fiscal_year AS sub_fiscal_year,",
    "    sv.total_obl_bin AS sub_total_obl_bin,",
    "    sv.recipient_name AS sub_awardee_or_recipient_legal,",
    "    sv.parent_recipient_name AS sub_ultimate_parent_legal_enti,",
    "    NULL AS business_type_code,",
    "    st.business_categories,",
    "    sv.treasury_account_identifiers,",
    "    st.pulled_from,",
    "    st.type_of_contract_pricing,",
    "    st.type_set_aside,",
    "    st.extent_competed,",
    "    st.product_or_service_code,",
    "    st.product_or_service_description,",
    "",
    "    sv.recipient_location_country_code AS sub_legal_entity_country_code,",
    "    st.recipient_location_country_name AS sub_legal_entity_country_name,",
    "    sv.recipient_location_county_code AS sub_legal_entity_county_code,",
    "    st.recipient_location_county_name AS sub_legal_entity_county_name,",
    "    sv.recipient_location_zip5 AS sub_legal_entity_zip5,",
    "    st.recipient_location_city_code AS sub_legal_entity_city_code,",
    "    sv.recipient_location_congressional_code AS sub_legal_entity_congressional,",
    "",
    "    st.place_of_perform_scope,",
    "    sv.pop_country_code AS sub_place_of_perform_country_co,",
    "    st.pop_country_name AS sub_place_of_perform_country_name,",
    "    sv.pop_county_code AS sub_place_of_perform_county_code,",
    "    st.pop_county_name AS sub_place_of_perform_county_name,",
    "    sv.pop_zip5 AS sub_place_of_perform_zip5,",
    "    st.pop_city_code AS sub_place_of_perform_city_code,",
    "    sv.pop_congressional_code AS sub_place_of_perform_congressio,",
    "",
    "    -- USAS Vectors",
    "    sv.keyword_ts_vector::TEXT,",
    "    sv.award_ts_vector::TEXT,",
    "    sv.recipient_name_ts_vector::TEXT",
    "",
    "FROM",
    "    raw.broker_subaward AS bs",
    "LEFT OUTER JOIN",
    "    int.subaward AS st",
    "        ON bs.id = st.id",
    "LEFT OUTER JOIN",
    "    rpt.subaward_view AS sv",
    "        ON bs.id = sv.subaward_id"
  ],
  "indexes": [
  ]
}
